N - количество сообщений в памяти
M - количество сообщений в БД
X - сообщений на удаление
Y - сообщения на добавление
Получить дерево сообщений. Получить разницу. Удалить убранные ключи. Внести новые: получить сообщение, добавить в дерево. 
(log(M)+M)+(N*M)+(X*(sum(0,x,i,log(i)+1)))+(sum(0,y,i,log(M-X+i)))

Получить сообщения. Удалить дерево. Создать новое дерево.
M+M+M*N*sum(0,N,i,log(i))


Пройтись по новому списку MID и получить Message. удалить дерево. Внести новые
N+M+sum(0,N,i,log(i))